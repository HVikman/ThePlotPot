"use strict";(self.webpackChunktheplotpot_frontend=self.webpackChunktheplotpot_frontend||[]).push([[821],{821:(e,t,o)=>{o.r(t),o.d(t,{default:()=>F});var n=o(7689),a=o(2506),r=o(8007),c=o(5057),i=o(5875),s=o(2791),l=o(7557),d=o(2621),p=o(732),u=o(187),h=o(3844),m=o(1694),g=o.n(m),f=o(8568),y=o(4170),b=o(1113),v=o(1929),C=o(7521),x=o(5564);const S=(e,t,o,n,a)=>({backgroundColor:e,border:"".concat(n.lineWidth,"px ").concat(n.lineType," ").concat(t),["".concat(a,"-icon")]:{color:o}}),w=e=>{const{componentCls:t,motionDurationSlow:o,marginXS:n,marginSM:a,fontSize:r,fontSizeLG:c,lineHeight:i,borderRadiusLG:s,motionEaseInOutCirc:l,withDescriptionIconSize:d,colorText:p,colorTextHeading:u,withDescriptionPadding:h,defaultPadding:m}=e;return{[t]:Object.assign(Object.assign({},(0,C.Wf)(e)),{position:"relative",display:"flex",alignItems:"center",padding:m,wordWrap:"break-word",borderRadius:s,["&".concat(t,"-rtl")]:{direction:"rtl"},["".concat(t,"-content")]:{flex:1,minWidth:0},["".concat(t,"-icon")]:{marginInlineEnd:n,lineHeight:0},"&-description":{display:"none",fontSize:r,lineHeight:i},"&-message":{color:u},["&".concat(t,"-motion-leave")]:{overflow:"hidden",opacity:1,transition:"max-height ".concat(o," ").concat(l,", opacity ").concat(o," ").concat(l,",\n        padding-top ").concat(o," ").concat(l,", padding-bottom ").concat(o," ").concat(l,",\n        margin-bottom ").concat(o," ").concat(l)},["&".concat(t,"-motion-leave-active")]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),["".concat(t,"-with-description")]:{alignItems:"flex-start",padding:h,["".concat(t,"-icon")]:{marginInlineEnd:a,fontSize:d,lineHeight:0},["".concat(t,"-message")]:{display:"block",marginBottom:n,color:u,fontSize:c},["".concat(t,"-description")]:{display:"block",color:p}},["".concat(t,"-banner")]:{marginBottom:0,border:"0 !important",borderRadius:0}}},I=e=>{const{componentCls:t,colorSuccess:o,colorSuccessBorder:n,colorSuccessBg:a,colorWarning:r,colorWarningBorder:c,colorWarningBg:i,colorError:s,colorErrorBorder:l,colorErrorBg:d,colorInfo:p,colorInfoBorder:u,colorInfoBg:h}=e;return{[t]:{"&-success":S(a,n,o,e,t),"&-info":S(h,u,p,e,t),"&-warning":S(i,c,r,e,t),"&-error":Object.assign(Object.assign({},S(d,l,s,e,t)),{["".concat(t,"-description > pre")]:{margin:0,padding:0}})}}},E=e=>{const{componentCls:t,iconCls:o,motionDurationMid:n,marginXS:a,fontSizeIcon:r,colorIcon:c,colorIconHover:i}=e;return{[t]:{"&-action":{marginInlineStart:a},["".concat(t,"-close-icon")]:{marginInlineStart:a,padding:0,overflow:"hidden",fontSize:r,lineHeight:"".concat(r,"px"),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",["".concat(o,"-close")]:{color:c,transition:"color ".concat(n),"&:hover":{color:i}}},"&-close-text":{color:c,transition:"color ".concat(n),"&:hover":{color:i}}}}},j=e=>[w(e),I(e),E(e)],N=(0,x.Z)("Alert",(e=>[j(e)]),(e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:"".concat(e.paddingContentVerticalSM,"px ").concat(12,"px"),withDescriptionPadding:"".concat(e.paddingMD,"px ").concat(e.paddingContentHorizontalLG,"px")})));var k=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o};const Z={success:l.Z,info:h.Z,error:d.Z,warning:u.Z},B=e=>{const{icon:t,prefixCls:o,type:n}=e,a=Z[n]||null;return t?(0,b.wm)(t,s.createElement("span",{className:"".concat(o,"-icon")},t),(()=>({className:g()("".concat(o,"-icon"),{[t.props.className]:t.props.className})}))):s.createElement(a,{className:"".concat(o,"-icon")})},O=e=>{const{isClosable:t,prefixCls:o,closeIcon:n,handleClose:a}=e,r=!0===n||void 0===n?s.createElement(p.Z,null):n;return t?s.createElement("button",{type:"button",onClick:a,className:"".concat(o,"-close-icon"),tabIndex:0},r):null};const M=e=>{const{description:t,prefixCls:o,message:n,banner:a,className:r,rootClassName:c,style:i,onMouseEnter:l,onMouseLeave:d,onClick:p,afterClose:u,showIcon:h,closable:m,closeText:b,closeIcon:C,action:x}=e,S=k(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action"]),[w,I]=s.useState(!1);const E=s.useRef(null),{getPrefixCls:j,direction:Z,alert:M}=s.useContext(v.E_),q=j("alert",o),[T,z]=N(q),H=t=>{var o;I(!0),null===(o=e.onClose)||void 0===o||o.call(e,t)},A=s.useMemo((()=>void 0!==e.type?e.type:a?"warning":"info"),[e.type,a]),D=s.useMemo((()=>!!b||("boolean"===typeof m?m:!1!==C&&null!==C&&void 0!==C)),[b,C,m]),L=!(!a||void 0!==h)||h,P=g()(q,"".concat(q,"-").concat(A),{["".concat(q,"-with-description")]:!!t,["".concat(q,"-no-icon")]:!L,["".concat(q,"-banner")]:!!a,["".concat(q,"-rtl")]:"rtl"===Z},null===M||void 0===M?void 0:M.className,r,c,z),R=(0,y.Z)(S,{aria:!0,data:!0});return T(s.createElement(f.ZP,{visible:!w,motionName:"".concat(q,"-motion"),motionAppear:!1,motionEnter:!1,onLeaveStart:e=>({maxHeight:e.offsetHeight}),onLeaveEnd:u},(o=>{let{className:a,style:r}=o;return s.createElement("div",Object.assign({ref:E,"data-show":!w,className:g()(P,a),style:Object.assign(Object.assign(Object.assign({},null===M||void 0===M?void 0:M.style),i),r),onMouseEnter:l,onMouseLeave:d,onClick:p,role:"alert"},R),L?s.createElement(B,{description:t,icon:e.icon,prefixCls:q,type:A}):null,s.createElement("div",{className:"".concat(q,"-content")},n?s.createElement("div",{className:"".concat(q,"-message")},n):null,t?s.createElement("div",{className:"".concat(q,"-description")},t):null),x?s.createElement("div",{className:"".concat(q,"-action")},x):null,s.createElement(O,{isClosable:D,prefixCls:q,closeIcon:b||C,handleClose:H}))})))};var q=o(5671),T=o(3144),z=o(136),H=o(8557);const A=function(e){(0,z.Z)(o,e);var t=(0,H.Z)(o);function o(){var e;return(0,q.Z)(this,o),(e=t.apply(this,arguments)).state={error:void 0,info:{componentStack:""}},e}return(0,T.Z)(o,[{key:"componentDidCatch",value:function(e,t){this.setState({error:e,info:t})}},{key:"render",value:function(){const{message:e,description:t,children:o}=this.props,{error:n,info:a}=this.state,r=a&&a.componentStack?a.componentStack:null,c="undefined"===typeof e?(n||"").toString():e,i="undefined"===typeof t?r:t;return n?s.createElement(M,{type:"error",message:c,description:s.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},i)}):o}}]),o}(s.Component),D=M;D.ErrorBoundary=A;const L=D;var P=o(3360),R=o(6770),W=o.n(R),X=(o(215),o(1684),o(4376)),_=o(9829);var G=o(8261),Q=(o(8281),o(184));const V=r.Ry({title:r.Z_().required("Required").max(100,"Must be 100 characters or less"),content:r.Z_().required("Required")}),$={title:"",content:"",honeypot:""},F=()=>{const e=(0,n.TH)(),{storyId:t,parentChapter:o,navigationStack:r}=e.state,{addNotification:s}=(0,G.z)(),[l,d]=((e,t,o,a)=>{const r=(0,n.s0)(),[c,{error:i}]=(0,X.D)(_.c$,{update:(n,c)=>{let{data:{createChapter:s}}=c;try{const{getStory:c}=n.readQuery({query:_.$X,variables:{id:e}}),i=[...c.chapters,s];n.writeQuery({query:_.$X,variables:{id:e},data:{getStory:{...c,chapters:i}}});const{getChapterChildren:l}=n.readQuery({query:_.SN,variables:{id:t.id}}),d=[...l,s];n.writeQuery({query:_.SN,variables:{id:t.id},data:{getChapterChildren:d}}),a("".concat(s.title," created successfully!"),2e3,"success"),console.log(s),r("/story/".concat(e),{state:{chapter:s,navigationStack:[...o,t]}})}catch(i){console.error("Error updating cache after adding chapter:",i),a(i.message,2e3,"error")}}});return[c,i]})(t,o,r,s),p=(0,a.TA)({initialValues:$,validationSchema:V,onSubmit:e=>{e.honeypot?console.log("Bot detected"):grecaptcha.ready((async()=>{const n=await grecaptcha.execute("6LfY0fooAAAAAKaljIbo723ZiMGApMCVg6ZU805o",{action:"submit"});l({variables:{storyId:t,parentChapterId:o.id,branch:o.branch+1,title:e.title,content:e.content,token:n}}).catch((e=>{console.error("There was an error creating the chapter:",e),s(e.message,3e3,"error")}))}))}});return(0,Q.jsxs)("div",{className:"add-chapter-container mx-4",children:[(0,Q.jsx)("h2",{children:"Add a New Chapter"}),(0,Q.jsxs)(c.Z,{layout:"vertical",onSubmit:p.handleSubmit,children:[(0,Q.jsx)(c.Z.Item,{label:"Title",help:p.touched.title&&p.errors.title,children:(0,Q.jsx)(i.Z,{type:"text",name:"title",placeholder:"Chapter title",onChange:p.handleChange,onBlur:p.handleBlur,value:p.values.title})}),(0,Q.jsx)(c.Z.Item,{style:{display:"none"},children:(0,Q.jsx)(i.Z,{type:"text",name:"honeypot",onChange:p.handleChange,onBlur:p.handleBlur,value:p.values.honeypot})}),(0,Q.jsxs)(c.Z.Item,{label:"Content",help:p.touched.content&&p.errors.content,children:[(0,Q.jsx)(W(),{value:p.values.content,placeholder:"Chapter content goes here...",onChange:e=>p.setFieldValue("content",e),theme:"snow",modules:{characterCounter:{container:"#char-count",maxChars:12e3},toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","blockquote"],[{list:"ordered"},{list:"bullet"}]]}}),(0,Q.jsx)("div",{id:"char-count"})]}),(0,Q.jsx)(P.Z,{variant:"secondary",onClick:()=>p.handleSubmit(),children:"Submit"})]}),d&&(0,Q.jsx)(L,{type:"error",message:d.message,className:"mt-3"})]})}},1684:(e,t,o)=>{var n=o(6921),a=o.n(n);class r{constructor(e,t){this.quill=e,this.options=t,this.container=document.querySelector(t.container),e.on("text-change",this.update.bind(this)),this.update()}calculate(){return this.quill.getText().length}update(){let e=this.calculate();if(e>this.options.maxChars){let e=this.quill.getText().substring(0,this.options.maxChars);this.quill.setText(e)}this.container.innerText=e+" / "+this.options.maxChars}}a().register("modules/characterCounter",r)},8281:()=>{}}]);
//# sourceMappingURL=821.7c2127e8.chunk.js.map