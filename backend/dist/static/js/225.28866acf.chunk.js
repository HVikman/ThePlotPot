"use strict";(self.webpackChunktheplotpot_frontend=self.webpackChunktheplotpot_frontend||[]).push([[225],{5225:(e,o,t)=>{t.r(o),t.d(o,{default:()=>_});var n=t(3216),c=t(3516),a=t(899),r=t(8782),i=t(2615),l=t(5043),s=t(2499),d=t(8528),u=t(3727),p=t(1376),h=t(3888),m=t(8139),g=t.n(m),v=t(7419),b=t(8060),f=t(2701),y=t(5296),C=t(6647),x=t(4414),S=t(1383);const I=(e,o,t,n,c)=>({background:e,border:"".concat((0,C.zA)(n.lineWidth)," ").concat(n.lineType," ").concat(o),["".concat(c,"-icon")]:{color:t}}),j=e=>{const{componentCls:o,motionDurationSlow:t,marginXS:n,marginSM:c,fontSize:a,fontSizeLG:r,lineHeight:i,borderRadiusLG:l,motionEaseInOutCirc:s,withDescriptionIconSize:d,colorText:u,colorTextHeading:p,withDescriptionPadding:h,defaultPadding:m}=e;return{[o]:Object.assign(Object.assign({},(0,x.dF)(e)),{position:"relative",display:"flex",alignItems:"center",padding:m,wordWrap:"break-word",borderRadius:l,["&".concat(o,"-rtl")]:{direction:"rtl"},["".concat(o,"-content")]:{flex:1,minWidth:0},["".concat(o,"-icon")]:{marginInlineEnd:n,lineHeight:0},"&-description":{display:"none",fontSize:a,lineHeight:i},"&-message":{color:p},["&".concat(o,"-motion-leave")]:{overflow:"hidden",opacity:1,transition:"max-height ".concat(t," ").concat(s,", opacity ").concat(t," ").concat(s,",\n        padding-top ").concat(t," ").concat(s,", padding-bottom ").concat(t," ").concat(s,",\n        margin-bottom ").concat(t," ").concat(s)},["&".concat(o,"-motion-leave-active")]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),["".concat(o,"-with-description")]:{alignItems:"flex-start",padding:h,["".concat(o,"-icon")]:{marginInlineEnd:c,fontSize:d,lineHeight:0},["".concat(o,"-message")]:{display:"block",marginBottom:n,color:p,fontSize:r},["".concat(o,"-description")]:{display:"block",color:u}},["".concat(o,"-banner")]:{marginBottom:0,border:"0 !important",borderRadius:0}}},E=e=>{const{componentCls:o,colorSuccess:t,colorSuccessBorder:n,colorSuccessBg:c,colorWarning:a,colorWarningBorder:r,colorWarningBg:i,colorError:l,colorErrorBorder:s,colorErrorBg:d,colorInfo:u,colorInfoBorder:p,colorInfoBg:h}=e;return{[o]:{"&-success":I(c,n,t,e,o),"&-info":I(h,p,u,e,o),"&-warning":I(i,r,a,e,o),"&-error":Object.assign(Object.assign({},I(d,s,l,e,o)),{["".concat(o,"-description > pre")]:{margin:0,padding:0}})}}},w=e=>{const{componentCls:o,iconCls:t,motionDurationMid:n,marginXS:c,fontSizeIcon:a,colorIcon:r,colorIconHover:i}=e;return{[o]:{"&-action":{marginInlineStart:c},["".concat(o,"-close-icon")]:{marginInlineStart:c,padding:0,overflow:"hidden",fontSize:a,lineHeight:(0,C.zA)(a),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",["".concat(t,"-close")]:{color:r,transition:"color ".concat(n),"&:hover":{color:i}}},"&-close-text":{color:r,transition:"color ".concat(n),"&:hover":{color:i}}}}},A=(0,S.OF)("Alert",(e=>[j(e),E(e),w(e)]),(e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:"".concat(e.paddingContentVerticalSM,"px ").concat(12,"px"),withDescriptionPadding:"".concat(e.paddingMD,"px ").concat(e.paddingContentHorizontalLG,"px")})));var k=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var c=0;for(n=Object.getOwnPropertySymbols(e);c<n.length;c++)o.indexOf(n[c])<0&&Object.prototype.propertyIsEnumerable.call(e,n[c])&&(t[n[c]]=e[n[c]])}return t};const N={success:s.A,info:h.A,error:d.A,warning:p.A},O=e=>{const{icon:o,prefixCls:t,type:n}=e,c=N[n]||null;return o?(0,f.fx)(o,l.createElement("span",{className:"".concat(t,"-icon")},o),(()=>({className:g()("".concat(t,"-icon"),{[o.props.className]:o.props.className})}))):l.createElement(c,{className:"".concat(t,"-icon")})},B=e=>{const{isClosable:o,prefixCls:t,closeIcon:n,handleClose:c,ariaProps:a}=e,r=!0===n||void 0===n?l.createElement(u.A,null):n;return o?l.createElement("button",Object.assign({type:"button",onClick:c,className:"".concat(t,"-close-icon"),tabIndex:0},a),r):null};const M=e=>{const{description:o,prefixCls:t,message:n,banner:c,className:a,rootClassName:r,style:i,onMouseEnter:s,onMouseLeave:d,onClick:u,afterClose:p,showIcon:h,closable:m,closeText:f,closeIcon:C,action:x}=e,S=k(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action"]),[I,j]=l.useState(!1);const E=l.useRef(null),{getPrefixCls:w,direction:N,alert:M}=l.useContext(y.QO),z=w("alert",t),[q,T,H]=A(z),P=o=>{var t;j(!0),null===(t=e.onClose)||void 0===t||t.call(e,o)},L=l.useMemo((()=>void 0!==e.type?e.type:c?"warning":"info"),[e.type,c]),D=l.useMemo((()=>!("object"!==typeof m||!m.closeIcon)||(!!f||("boolean"===typeof m?m:!1!==C&&null!==C&&void 0!==C||!!(null===M||void 0===M?void 0:M.closable)))),[f,C,m,null===M||void 0===M?void 0:M.closable]),V=!(!c||void 0!==h)||h,W=g()(z,"".concat(z,"-").concat(L),{["".concat(z,"-with-description")]:!!o,["".concat(z,"-no-icon")]:!V,["".concat(z,"-banner")]:!!c,["".concat(z,"-rtl")]:"rtl"===N},null===M||void 0===M?void 0:M.className,a,r,H,T),R=(0,b.A)(S,{aria:!0,data:!0}),Q=l.useMemo((()=>{var e,o;return"object"===typeof m&&m.closeIcon?m.closeIcon:f||(void 0!==C?C:"object"===typeof(null===M||void 0===M?void 0:M.closable)&&(null===(e=null===M||void 0===M?void 0:M.closable)||void 0===e?void 0:e.closeIcon)?null===(o=null===M||void 0===M?void 0:M.closable)||void 0===o?void 0:o.closeIcon:null===M||void 0===M?void 0:M.closeIcon)}),[C,m,f,null===M||void 0===M?void 0:M.closeIcon]),G=l.useMemo((()=>{const e=null!==m&&void 0!==m?m:null===M||void 0===M?void 0:M.closable;if("object"===typeof e){const{closeIcon:o}=e;return k(e,["closeIcon"])}return{}}),[m,null===M||void 0===M?void 0:M.closable]);return q(l.createElement(v.Ay,{visible:!I,motionName:"".concat(z,"-motion"),motionAppear:!1,motionEnter:!1,onLeaveStart:e=>({maxHeight:e.offsetHeight}),onLeaveEnd:p},(t=>{let{className:c,style:a}=t;return l.createElement("div",Object.assign({ref:E,"data-show":!I,className:g()(W,c),style:Object.assign(Object.assign(Object.assign({},null===M||void 0===M?void 0:M.style),i),a),onMouseEnter:s,onMouseLeave:d,onClick:u,role:"alert"},R),V?l.createElement(O,{description:o,icon:e.icon,prefixCls:z,type:L}):null,l.createElement("div",{className:"".concat(z,"-content")},n?l.createElement("div",{className:"".concat(z,"-message")},n):null,o?l.createElement("div",{className:"".concat(z,"-description")},o):null),x?l.createElement("div",{className:"".concat(z,"-action")},x):null,l.createElement(B,{isClosable:D,prefixCls:z,closeIcon:Q,handleClose:P,ariaProps:G}))})))};var z=t(3029),q=t(2901),T=t(9874),H=t(5501);const P=function(e){function o(){var e;return(0,z.A)(this,o),(e=(0,T.A)(this,o,arguments)).state={error:void 0,info:{componentStack:""}},e}return(0,H.A)(o,e),(0,q.A)(o,[{key:"componentDidCatch",value:function(e,o){this.setState({error:e,info:o})}},{key:"render",value:function(){const{message:e,description:o,children:t}=this.props,{error:n,info:c}=this.state,a=c&&c.componentStack?c.componentStack:null,r="undefined"===typeof e?(n||"").toString():e,i="undefined"===typeof o?a:o;return n?l.createElement(M,{type:"error",message:r,description:l.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},i)}):t}}])}(l.Component),L=M;L.ErrorBoundary=P;const D=L;var V=t(4282),W=t(2823),R=t.n(W),Q=(t(7590),t(1393),t(1881)),G=t(4743);var F=t(1898),X=(t(583),t(579));const Y=a.Ik({title:a.Yj().required("Required").max(100,"Must be 100 characters or less"),content:a.Yj().required("Required")}),Z={title:"",content:"",honeypot:""},_=()=>{const e=(0,n.zy)(),{storyId:o,parentChapter:t,navigationStack:a}=e.state,{addNotification:l}=(0,F.E)(),[s,d]=((e,o,t,c)=>{const a=(0,n.Zp)(),[r,{error:i}]=(0,Q.n)(G.xT,{update:(n,r)=>{let{data:{createChapter:l}}=r;try{const{getStory:r}=n.readQuery({query:G.Vm,variables:{id:e}}),i=[...r.chapters,l];n.writeQuery({query:G.Vm,variables:{id:e},data:{getStory:{...r,chapters:i}}});const{getChapterChildren:s}=n.readQuery({query:G.VE,variables:{id:o.id}}),d=[...s,l];n.writeQuery({query:G.VE,variables:{id:o.id},data:{getChapterChildren:d}}),c("".concat(l.title," created successfully!"),2e3,"success"),console.log(l),a("/story/".concat(e),{state:{chapter:l,navigationStack:[...t,o]}})}catch(i){console.error("Error updating cache after adding chapter:",i),c(i.message,2e3,"error")}}});return[r,i]})(o,t,a,l),u=(0,c.Wx)({initialValues:Z,validationSchema:Y,onSubmit:e=>{e.honeypot?console.log("Bot detected"):grecaptcha.ready((async()=>{const n=await grecaptcha.execute("6LfY0fooAAAAAKaljIbo723ZiMGApMCVg6ZU805o",{action:"submit"});s({variables:{storyId:o,parentChapterId:t.id,branch:t.branch+1,title:e.title,content:e.content,token:n}}).catch((e=>{console.error("There was an error creating the chapter:",e),l(e.message,3e3,"error")}))}))}});return(0,X.jsxs)("div",{className:"add-chapter-container mx-4",children:[(0,X.jsx)("h2",{children:"Add a New Chapter"}),(0,X.jsxs)(r.A,{layout:"vertical",onSubmit:u.handleSubmit,children:[(0,X.jsx)(r.A.Item,{label:"Title",help:u.touched.title&&u.errors.title,children:(0,X.jsx)(i.A,{type:"text",name:"title",placeholder:"Chapter title",onChange:u.handleChange,onBlur:u.handleBlur,value:u.values.title})}),(0,X.jsx)(r.A.Item,{style:{display:"none"},children:(0,X.jsx)(i.A,{type:"text",name:"honeypot",onChange:u.handleChange,onBlur:u.handleBlur,value:u.values.honeypot})}),(0,X.jsxs)(r.A.Item,{label:"Content",help:u.touched.content&&u.errors.content,children:[(0,X.jsx)(R(),{value:u.values.content,placeholder:"Chapter content goes here...",onChange:e=>u.setFieldValue("content",e),theme:"snow",modules:{characterCounter:{container:"#char-count",maxChars:12e3},toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","blockquote"],[{list:"ordered"},{list:"bullet"}]]}}),(0,X.jsx)("div",{id:"char-count"})]}),(0,X.jsx)(V.A,{variant:"secondary",onClick:()=>u.handleSubmit(),children:"Submit"})]}),d&&(0,X.jsx)(D,{type:"error",message:d.message,className:"mt-3"})]})}},1393:(e,o,t)=>{var n=t(4175),c=t.n(n);class a{constructor(e,o){this.quill=e,this.options=o,this.container=document.querySelector(o.container),e.on("text-change",this.update.bind(this)),this.update()}calculate(){return this.quill.getText().length}update(){let e=this.calculate();if(e>this.options.maxChars){let e=this.quill.getText().substring(0,this.options.maxChars);this.quill.setText(e)}this.container.innerText=e+" / "+this.options.maxChars}}c().register("modules/characterCounter",a)},583:()=>{}}]);
//# sourceMappingURL=225.28866acf.chunk.js.map