"use strict";(self.webpackChunktheplotpot_frontend=self.webpackChunktheplotpot_frontend||[]).push([[629],{4010:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var a=r(3216),n=r(3964),o=r(899),s=r(6216),l=r(6311),i=r(4282),c=r(2823),h=r.n(c),d=(r(7590),r(1393),r(1881)),u=r(4743);var p=r(1898),x=(r(583),r(6133)),m=(r(4838),r(579));const y={characterCounter:{container:"#char-count",maxChars:12e3},toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","blockquote"],[{list:"ordered"},{list:"bullet"}]]},g=o.Ik({title:o.Yj().required("Required").max(100,"Must be 100 characters or less"),content:o.Yj().required("Required").max(12e3,"Content must be 12000 characters or less")}),C={title:"",content:"",honeypot:""},b=()=>{const{isDarkMode:e}=(0,x.D2)(),t=(0,a.zy)(),{storyId:r,parentChapter:o,navigationStack:c}=t.state,{addNotification:b}=(0,p.E)(),[v]=((e,t,r,n)=>{const o=(0,a.Zp)(),[s,{error:l}]=(0,d.n)(u.xT,{update:(a,s)=>{let{data:{createChapter:i}}=s;try{const{getStory:s}=a.readQuery({query:u.Vm,variables:{id:e}}),l=[...s.chapters,i];a.writeQuery({query:u.Vm,variables:{id:e},data:{getStory:{...s,chapters:l}}});const{getChapterChildren:c}=a.readQuery({query:u.VE,variables:{id:t.id}}),h=[...c,i];a.writeQuery({query:u.VE,variables:{id:t.id},data:{getChapterChildren:h}}),n("".concat(i.title," created successfully!"),2e3,"success"),console.log(i),o("/story/".concat(e),{state:{chapter:i,navigationStack:[...r,t]}})}catch(l){console.error("Error updating cache after adding chapter:",l),n(l.message,2e3,"error")}}});return[s,l]})(r,o,c,b),j=(0,n.Wx)({initialValues:C,validationSchema:g,onSubmit:e=>{e.honeypot?console.log("Bot detected"):v({variables:{storyId:r,parentChapterId:o.id,branch:o.branch+1,title:e.title,content:e.content}}).catch((e=>{console.error("There was an error creating the chapter:",e),b(e.message,3e3,"error")}))}});return(0,m.jsxs)("div",{className:"add-chapter-container mx-4",children:[(0,m.jsx)("h2",{children:"Add a New Chapter"}),(0,m.jsxs)(s.A,{onSubmit:j.handleSubmit,className:"".concat(e?"dark-mode":"light-mode"),children:[(0,m.jsxs)(s.A.Group,{controlId:"formTitle",children:[(0,m.jsx)(s.A.Label,{children:"Title"}),(0,m.jsx)(l.A,{type:"text",placeholder:"Chapter title",name:"title",onChange:j.handleChange,onBlur:j.handleBlur,value:j.values.title}),j.touched.title&&j.errors.title&&(0,m.jsx)(s.A.Text,{className:"text-danger",children:j.errors.title})]}),(0,m.jsx)(s.A.Group,{controlId:"formHoneypot",children:(0,m.jsx)(l.A,{type:"text",name:"honeypot",onChange:j.handleChange,onBlur:j.handleBlur,value:j.values.honeypot,style:{display:"none"}})}),(0,m.jsxs)(s.A.Group,{controlId:"formContent",children:[(0,m.jsx)(s.A.Label,{children:"Content"}),(0,m.jsx)(h(),{value:j.values.content,placeholder:"Chapter content goes here...",onChange:e=>j.setFieldValue("content",e),onBlur:()=>j.setFieldTouched("content",!0),theme:"snow",modules:y}),j.touched.content&&j.errors.content&&(0,m.jsx)(s.A.Text,{className:"text-danger",children:j.errors.content}),(0,m.jsx)("div",{id:"char-count"})]}),(0,m.jsx)(i.A,{variant:"secondary",type:"submit",children:"Submit"})]})]})}},1393:(e,t,r)=>{var a=r(9867);class n{constructor(e,t){this.quill=e,this.options=t,this.container=document.querySelector(t.container),e.on("text-change",this.update.bind(this)),this.update()}calculate(){return this.quill.getText().length-1}update(){let e=this.calculate();if(e>this.options.maxChars){let e=this.quill.getText().substring(0,this.options.maxChars);this.quill.setText(e)}this.container.innerText=e+" / "+this.options.maxChars}}a.Ay.register("modules/characterCounter",n)},583:()=>{},4838:()=>{}}]);
//# sourceMappingURL=629.40eb6e08.chunk.js.map