"use strict";(self.webpackChunktheplotpot_frontend=self.webpackChunktheplotpot_frontend||[]).push([[546],{6916:function(e,t,r){r(2791);var n=r(7022),a=r(2469),s=r(3360),o=r(184);t.Z=function(e){var t=e.message,r=e.onRetry;return(0,o.jsx)(n.Z,{className:"mt-5",children:(0,o.jsxs)(a.Z,{variant:"danger",children:[(0,o.jsx)(a.Z.Heading,{children:"Oh snap! An error occurred."}),(0,o.jsx)("p",{children:t||"Something went wrong. Please try again later."}),r&&(0,o.jsx)(s.Z,{variant:"primary",onClick:r,children:"Retry"})]})})}},8546:function(e,t,r){r.r(t),r.d(t,{default:function(){return M}});var n=r(3433),a=r(9439),s=r(2791),o=r(6578),c=r(6586),i=r(7689),l=r(1087),d=r(4165),u=r(5861),h=r(8703),m=r.n(h),p=r(3360),x=r(3812),f=r(3746),g=r(6534),y=r(4376),v=r(9829),j=r(8261),Z=r(7022),C=r(9140),b=r(9743),w=r(2677),k=r(7633),S=r(184),N=function(e){var t=e.comment,r=e.user,n=e.deleteComment,s=(0,j.z)().addNotification,o=(0,y.D)(v.Di),c=(0,a.Z)(o,1)[0],i=function(){var e=(0,u.Z)((0,d.Z)().mark((function e(){var r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c({variables:{commentId:t.id}});case 3:r=e.sent,a=r.data,console.log(a),n(t.id),s("Comment deleted successfully!",3e3,"success"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("There was an error deleting the comment:",e.t0),s(e.t0.message,3e3,"error");case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();return(0,S.jsx)(C.Z,{className:"mt-3",children:(0,S.jsx)(C.Z.Body,{children:(0,S.jsxs)(b.Z,{children:[(0,S.jsx)(w.Z,{xs:3,md:1,children:(0,S.jsx)("img",{src:"https://www.gravatar.com/avatar/".concat(t.user.email,"?s=400&d=robohash"),className:"img-fluid rounded-circle",alt:"User Gravatar"})}),(0,S.jsxs)(w.Z,{xs:8,md:10,children:[(0,S.jsx)(C.Z.Title,{children:(0,S.jsx)(l.rU,{style:{color:"inherit",textDecoration:"inherit"},to:"/user/".concat(t.user.id),children:t.user.username})}),(0,S.jsx)(C.Z.Text,{children:t.content})]}),(0,S.jsx)(w.Z,{xs:1,md:1,className:"d-flex align-items-start justify-content-end",children:r&&(0,S.jsxs)(S.Fragment,{children:[r.id===t.user.id&&(0,S.jsx)(k.Z,{title:"Delete your comment?",description:"Are you sure you want to delete your comment?",onConfirm:i,okText:"Yes",cancelText:"No",children:(0,S.jsx)(p.Z,{variant:"danger",children:"Delete"})}),r.has_superpowers&&(0,S.jsx)(k.Z,{title:"Admin Delete",description:"Are you sure you want to delete this user's comment as an admin?",onConfirm:i,okText:"Yes",cancelText:"No",children:(0,S.jsx)(p.Z,{variant:"warning",children:"Admin Delete"})})]})})]})})})},T=r(5705),A=r(8007),I=r(9795),D=A.Ry({content:A.Z_().required("Required").min(10,"Comment must be atleast 10 characters").max(1e3,"Must be 1000 characters or less")}),_={content:"",honeypot:""},Y=function(e){var t=e.chapterId,r=e.addNewComment,n=(0,j.z)().addNotification,s=(0,y.D)(v.n8),o=(0,a.Z)(s,1)[0],c=(0,T.TA)({initialValues:_,validationSchema:D,onSubmit:function(){var e=(0,u.Z)((0,d.Z)().mark((function e(a){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),!a.honeypot){e.next=4;break}return console.log("Bot detected"),e.abrupt("return");case 4:grecaptcha.ready((0,u.Z)((0,d.Z)().mark((function e(){var s,i,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,grecaptcha.execute("6LfY0fooAAAAAKaljIbo723ZiMGApMCVg6ZU805o",{action:"submit"});case 2:return s=e.sent,e.prev=3,e.next=6,o({variables:{Input:{content:a.content,chapterId:t},token:s}});case 6:i=e.sent,l=i.data,r(l.addComment),n("Comment added successfully!",3e3,"success"),c.resetForm(),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),console.error("There was an error adding the comment:",e.t0),n(e.t0.message,3e3,"error");case 17:case"end":return e.stop()}}),e,null,[[3,13]])}))));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});return(0,S.jsxs)("div",{className:"add-comment-container mt-3",children:[(0,S.jsx)("h2",{children:"Add a Comment"}),(0,S.jsxs)(I.Z,{onSubmit:c.handleSubmit,children:[(0,S.jsxs)(I.Z.Group,{controlId:"commentContent",className:"my-2 custom-form",children:[(0,S.jsx)(I.Z.Control,{as:"textarea",name:"content",placeholder:"Your comment...",onChange:c.handleChange,onBlur:c.handleBlur,value:c.values.content,isInvalid:c.touched.content&&c.errors.content}),(0,S.jsx)(I.Z.Control.Feedback,{type:"invalid",children:c.errors.content})]}),(0,S.jsx)(I.Z.Control,{style:{display:"none"},name:"honeypot",onChange:c.handleChange,value:c.values.honeypot}),(0,S.jsx)(p.Z,{variant:"secondary",type:"submit",children:"Submit"})]})]})},B=function(e){var t=e.comments,r=e.chapterId,o=(0,x.a)().user,c=!!o,i=(0,s.useState)(t),l=(0,a.Z)(i,2),d=l[0],u=l[1],h=function(e){u((function(t){return t.filter((function(t){return t.id!==e}))}))};return(0,S.jsxs)(Z.Z,{fluid:!0,className:"my-4 py-2",children:[(0,S.jsx)("h1",{children:"Comments"}),d&&d.length>0?d.map((function(e){return(0,S.jsx)(N,{comment:e,user:o,deleteComment:h},e.id)})):c?(0,S.jsx)("p",{children:"No comments yet, be first to comment!"}):(0,S.jsxs)("p",{children:["No comments yet, ",(0,S.jsx)("a",{href:"/login",children:"login"})," or ",(0,S.jsx)("a",{href:"/signup",children:"signup"})," to comment!"]}),c&&(0,S.jsx)(Y,{chapterId:r,addNewComment:function(e){u((function(t){return[].concat((0,n.Z)(t),[e])}))}})]})},L=function(e){var t=e.chapter,r=e.childChapters,n=e.onNavigate,c=e.onAddChapter,l=e.onGoBack,h=e.isLoading,Z=(0,j.z)().addNotification,C=(0,i.s0)(),b=(0,y.D)(v.ez),w=(0,a.Z)(b,1)[0],N=(0,y.D)(v.tT),T=(0,a.Z)(N,1)[0],A=(0,s.useState)(null),I=(0,a.Z)(A,2),D=I[0],_=I[1],Y=(0,s.useState)(!1),L=(0,a.Z)(Y,2),E=L[0],z=L[1],U=function(e){var t=(0,o.a)(v.vR,{variables:{id:e}}).data;return!!t&&t.isChapterLiked}(t.id);(0,s.useEffect)((function(){_(U)}),[U]);var F=function(){var e=(0,j.z)().addNotification,t=(0,y.D)(v.WQ),r=(0,a.Z)(t,1)[0],n=(0,y.D)(v.QN),s=(0,a.Z)(n,1)[0],o=function(){var t=(0,u.Z)((0,d.Z)().mark((function t(n,a){var o,c,i,l;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}return t.next=3,r({variables:{id:a}});case 3:return o=t.sent,c=o.data,e("Chapter liked",1e3,"success"),t.abrupt("return",c.likeChapter);case 9:return t.next=11,s({variables:{id:a}});case 11:return i=t.sent,l=i.data,e("Like removed",1e3,"error"),t.abrupt("return",l.unlikeChapter);case 15:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}();return o}(),M=function(){var e=(0,u.Z)((0,d.Z)().mark((function e(){var r,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z(!0),D){e.next=10;break}return e.next=4,F(!0,t.id);case 4:r=e.sent,t.votes_count=t.votes_count+1,_(!0),console.log("Like result:",r),e.next=16;break;case 10:return e.next=12,F(!1,t.id);case 12:n=e.sent,_(!1),t.votes_count=t.votes_count-1,console.log("Unlike result:",n);case 16:setTimeout((function(){z(!1)}),1e3);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,u.Z)((0,d.Z)().mark((function e(){var r,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),e.prev=1,0!==t.branch){e.next=9;break}return e.next=5,T({variables:{id:t.story.id}});case 5:(r=e.sent).data.deleteStory.success?(Z(r.data.deleteStory.message,3e3,"success"),C("/"),console.log("Story deleted successfully")):(console.error(r.data.deleteStory.message),Z(r.data.deleteStory.message,3e3,"error")),e.next=13;break;case 9:return e.next=11,w({variables:{id:t.id}});case 11:(n=e.sent).data.deleteChapter.success?(Z(n.data.deleteChapter.message,3e3,"success"),C("/"),console.log("Chapter deleted successfully")):(console.error(n.data.deleteChapter.message),Z(n.data.deleteChapter.message,3e3,"error"));case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("Error deleting:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(){return e.apply(this,arguments)}}(),G=(0,x.a)().user,P=!!G,q=m().sanitize(t.content);return(0,S.jsxs)("div",{className:"chapter",children:[(0,S.jsx)(p.Z,{variant:"secondary",className:"mb-3",onClick:function(){return l()},children:(0,S.jsx)(f.Z,{})}),(0,S.jsx)("div",{className:"chapter-content shadow my-2",dangerouslySetInnerHTML:{__html:q}}),(0,S.jsxs)("div",{className:"chapter-stats m-2",children:[P?G.id===t.author.id?0===r.length?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(k.Z,{title:0===t.branch?"Delete story":"Delete chapter",description:0===t.branch?"Are you sure you want to delete this story":"Are you sure you want to delete this chapter",onConfirm:R,okText:"Yes",cancelText:"No",children:(0,S.jsx)(p.Z,{variant:"danger",children:"Delete"})}),(0,S.jsx)("span",{children:"Likes:"})]}):(0,S.jsx)("span",{children:"Likes: "}):(0,S.jsx)(p.Z,{disabled:E,variant:D?"success":"secondary",className:"mt-2",onClick:function(){return M()},children:(0,S.jsx)(g.Z,{})}):(0,S.jsx)("span",{children:"Likes:"}),G?G.has_superpowers&&(0,S.jsx)(k.Z,{title:0===t.branch?"Delete story":"Delete chapter",description:0===t.branch?"Are you sure you want to delete this story":"Are you sure you want to delete this chapter",onConfirm:R,okText:"Yes",cancelText:"No",children:(0,S.jsx)(p.Z,{variant:"danger",children:"Admin delete"})}):(0,S.jsx)(S.Fragment,{}),(0,S.jsx)("span",{children:t.votes_count})]}),(0,S.jsxs)("div",{className:"next-chapters m-2",children:[!h&&P&&r.length<3&&t.branch<9&&(0,S.jsx)(p.Z,{variant:"secondary",className:"mr-3 mt-2",onClick:function(){return c()},children:"Add Chapter"}),r.map((function(e){return(0,S.jsxs)(p.Z,{variant:"secondary",className:"mr-3 mt-2",onClick:function(){return n(e.id)},children:["Continue to: ",e.title]},e.id)}))]}),(0,S.jsx)(B,{comments:t.comments,chapterId:t.id},t.id)]})},E=r(43),z=["Your epic saga is so vast, even our scrolls are taking a while. Hang tight!","Your tale's intrigue has our library elves on their toes. One moment!","Such a legendary story requires some extra ink and quill. Bear with us...","Even the grand storytellers of old would be impressed! Prepping your narrative...","Your chapters are so gripping, our books needed a breather. Stay tuned...","Paging all scribes! Your monumental tale is on the way...","Even our magic mirrors need a second to capture the grandeur of your plot. Patience!","Your story has so many layers, even the onions are jealous. Peeling back the pages...","With tales as epic as yours, even the stars stop to listen. Setting the stage...","Weaving tales this intricate takes a touch of sorcery. Conjuring your story..."],U=function(){return(0,S.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:(0,S.jsx)(C.Z,{style:{width:"300px",textAlign:"center"},children:(0,S.jsxs)(C.Z.Body,{children:[(0,S.jsx)(E.Z,{size:"large"}),(0,S.jsx)(C.Z.Title,{children:"Fetching the Story..."}),(0,S.jsx)(C.Z.Text,{children:z[Math.floor(Math.random()*z.length)]})]})})})},F=r(6916),M=function(){var e=(0,i.s0)(),t=(0,i.UO)(),r=t.storyId,d=t.chapterId,u=(0,o.a)(v.$X,{variables:{id:r,chapterId:d}}),h=u.data,m=u.loading,p=u.error,x=(0,c.t)(v.SN),f=(0,a.Z)(x,2),g=f[0],y=f[1],j=y.data,k=y.loading,N=(0,c.t)(v.KV),T=(0,a.Z)(N,2),A=T[0],I=T[1].data,D=(0,i.TH)().state||{},_=D.chapter,Y=D.navigationStack,B=(0,s.useState)(null),E=(0,a.Z)(B,2),z=E[0],M=E[1],R=(0,s.useState)([]),G=(0,a.Z)(R,2),P=G[0],q=G[1];if((0,s.useEffect)((function(){_?(M(_),window.history.replaceState(null,"","/story/".concat(r,"/chapter/").concat(_.id)),Y&&q(Y)):h&&h.getStory&&h.getStory.chapters&&M(h.getStory.chapters[0])}),[_,h,Y,r]),(0,s.useEffect)((function(){z&&g({variables:{id:z.id}})}),[z,g]),(0,s.useEffect)((function(){I&&I.getChapter&&(M(I.getChapter),window.history.replaceState(null,"","/story/".concat(r,"/chapter/").concat(I.getChapter.id)))}),[I,r]),m)return(0,S.jsx)(U,{});if(p)return(0,S.jsx)(F.Z,{message:p.message});return(0,S.jsx)(Z.Z,{className:"mt-5",children:(0,S.jsxs)(b.Z,{children:[(0,S.jsx)(w.Z,{md:9,children:z&&(0,S.jsx)(L,{chapter:z,childChapters:j?j.getChapterChildren:[],onNavigate:function(e){var t;j&&j.getChapterChildren?t=j.getChapterChildren:h&&h.getStory&&Array.isArray(h.getStory.chapters)&&(t=h.getStory.chapters),window.scrollTo({top:0,behavior:"smooth"}),q([].concat((0,n.Z)(P),[z]));var a=t.find((function(t){return t.id===e}));a?(M(a),window.history.replaceState(null,"","/story/".concat(r,"/chapter/").concat(a.id)),g({variables:{id:a.id}})):console.log("Chapter not found with the given ID:",e)},onAddChapter:function(){e("/add-chapter",{state:{storyId:r,parentChapter:z,navigationStack:P}})},onGoBack:function(){var t=P.pop();window.scrollTo({top:0,behavior:"smooth"}),console.log(z),q((0,n.Z)(P)),t?(M(t),window.history.replaceState(null,"","/story/".concat(r,"/chapter/").concat(t.id))):z&&z.parentChapterId?A({variables:{getChapterId:z.parentChapterId}}):e("/")},isLoading:k})}),(0,S.jsx)(w.Z,{md:3,children:z&&(0,S.jsx)(C.Z,{children:(0,S.jsxs)(C.Z.Body,{children:[(0,S.jsx)(C.Z.Title,{children:h.getStory.title}),(0,S.jsx)(C.Z.Subtitle,{className:"mb-2 text-muted",children:h.getStory.genre}),z.title&&(0,S.jsxs)(C.Z.Text,{children:["Chapter ",z.branch+1,":",(0,S.jsx)("br",{})," ",z.title]}),(0,S.jsx)(C.Z.Text,{children:(0,S.jsxs)("span",{children:["Reads: ",z&&z.reads_count]})}),(0,S.jsx)(C.Z.Text,{children:(0,S.jsxs)("small",{className:"text-muted",children:["Written by: ",z?(0,S.jsx)(l.rU,{to:"/user/".concat(z.author.id),children:z.author.username}):(0,S.jsx)(l.rU,{to:"/user/".concat(h.getStory.author.id),children:h.getStory.author.username})]})}),0===z.branch?(0,S.jsx)(C.Z.Text,{children:h.getStory.description}):null,z.author.coffee&&(0,S.jsxs)(C.Z.Text,{children:["Enjoying what ",z.author.username," is writing? ",(0,S.jsx)("a",{href:z.author.coffee,target:"_blank",rel:"noreferrer",children:" Buy them a coffee "}),"  "]})]})})})]})})}}}]);
//# sourceMappingURL=546.362029d4.chunk.js.map