"use strict";(self.webpackChunktheplotpot_frontend=self.webpackChunktheplotpot_frontend||[]).push([[546],{6916:(e,t,r)=>{r.d(t,{Z:()=>c});r(2791);var s=r(7022),a=r(18),n=r(3360),o=r(184);const c=e=>{let{message:t,onRetry:r}=e;return(0,o.jsx)(s.Z,{className:"mt-5",children:(0,o.jsxs)(a.Z,{variant:"danger",children:[(0,o.jsx)(a.Z.Heading,{children:"Oh snap! An error occurred."}),(0,o.jsx)("p",{children:t||"Something went wrong. Please try again later."}),r&&(0,o.jsx)(n.Z,{variant:"primary",onClick:r,children:"Retry"})]})})}},8546:(e,t,r)=>{r.r(t),r.d(t,{default:()=>E});var s=r(2791),a=r(6578),n=r(6586),o=r(7689),c=r(1087),i=r(8703),l=r.n(i),d=r(3360),h=r(3812),u=r(3746),m=r(6534),p=r(4376),x=r(9829),y=r(8261);var g=r(7022),j=r(5070),v=r(9743),C=r(2677),f=r(7633),Z=r(184);const w=e=>{let{comment:t,user:r,deleteComment:s}=e;const{addNotification:a}=(0,y.z)(),[n]=(0,p.D)(x.Di),o=async()=>{try{const{data:e}=await n({variables:{commentId:t.id}});console.log(e),s(t.id),a("Comment deleted successfully!",3e3,"success")}catch(e){console.error("There was an error deleting the comment:",e),a(e.message,3e3,"error")}};return(0,Z.jsx)(j.Z,{className:"mt-3",children:(0,Z.jsx)(j.Z.Body,{children:(0,Z.jsxs)(v.Z,{children:[(0,Z.jsx)(C.Z,{xs:3,md:1,children:(0,Z.jsx)("img",{src:"https://www.gravatar.com/avatar/".concat(t.user.email,"?s=400&d=robohash"),className:"img-fluid rounded-circle",alt:"User Gravatar"})}),(0,Z.jsxs)(C.Z,{xs:8,md:10,children:[(0,Z.jsx)(j.Z.Title,{children:(0,Z.jsx)(c.rU,{style:{color:"inherit",textDecoration:"inherit"},to:"/user/".concat(t.user.id),children:t.user.username})}),(0,Z.jsx)(j.Z.Text,{children:t.content})]}),(0,Z.jsx)(C.Z,{xs:1,md:1,className:"d-flex align-items-start justify-content-end",children:r&&(0,Z.jsxs)(Z.Fragment,{children:[r.id===t.user.id&&(0,Z.jsx)(f.Z,{title:"Delete your comment?",description:"Are you sure you want to delete your comment?",onConfirm:o,okText:"Yes",cancelText:"No",children:(0,Z.jsx)(d.Z,{variant:"danger",children:"Delete"})}),r.has_superpowers&&(0,Z.jsx)(f.Z,{title:"Admin Delete",description:"Are you sure you want to delete this user's comment as an admin?",onConfirm:o,okText:"Yes",cancelText:"No",children:(0,Z.jsx)(d.Z,{variant:"warning",children:"Admin Delete"})})]})})]})})})};var b=r(2506),S=r(8007),k=r(9795);const N=S.Ry({content:S.Z_().required("Required").min(10,"Comment must be atleast 10 characters").max(1e3,"Must be 1000 characters or less")}),T={content:"",honeypot:""},A=e=>{let{chapterId:t,addNewComment:r}=e;const{addNotification:s}=(0,y.z)(),[a]=(0,p.D)(x.n8),n=(0,b.TA)({initialValues:T,validationSchema:N,onSubmit:async e=>{console.log(t),e.honeypot?console.log("Bot detected"):grecaptcha.ready((async()=>{const o=await grecaptcha.execute("6LfY0fooAAAAAKaljIbo723ZiMGApMCVg6ZU805o",{action:"submit"});try{const{data:c}=await a({variables:{Input:{content:e.content,chapterId:t},token:o}});r(c.addComment),s("Comment added successfully!",3e3,"success"),n.resetForm()}catch(c){console.error("There was an error adding the comment:",c),s(c.message,3e3,"error")}}))}});return(0,Z.jsxs)("div",{className:"add-comment-container mt-3",children:[(0,Z.jsx)("h2",{children:"Add a Comment"}),(0,Z.jsxs)(k.Z,{onSubmit:n.handleSubmit,children:[(0,Z.jsxs)(k.Z.Group,{controlId:"commentContent",className:"my-2 custom-form",children:[(0,Z.jsx)(k.Z.Control,{as:"textarea",name:"content",placeholder:"Your comment...",onChange:n.handleChange,onBlur:n.handleBlur,value:n.values.content,isInvalid:n.touched.content&&n.errors.content}),(0,Z.jsx)(k.Z.Control.Feedback,{type:"invalid",children:n.errors.content})]}),(0,Z.jsx)(k.Z.Control,{style:{display:"none"},name:"honeypot",onChange:n.handleChange,value:n.values.honeypot}),(0,Z.jsx)(d.Z,{variant:"secondary",type:"submit",children:"Submit"})]})]})},I=e=>{let{comments:t,chapterId:r}=e;const{user:a}=(0,h.a)(),n=!!a,[o,c]=(0,s.useState)(t),i=e=>{c((t=>t.filter((t=>t.id!==e))))};return(0,Z.jsxs)(g.Z,{fluid:!0,className:"my-4 py-2",children:[(0,Z.jsx)("h1",{children:"Comments"}),o&&o.length>0?o.map((e=>(0,Z.jsx)(w,{comment:e,user:a,deleteComment:i},e.id))):n?(0,Z.jsx)("p",{children:"No comments yet, be first to comment!"}):(0,Z.jsxs)("p",{children:["No comments yet, ",(0,Z.jsx)("a",{href:"/login",children:"login"})," or ",(0,Z.jsx)("a",{href:"/signup",children:"signup"})," to comment!"]}),n&&(0,Z.jsx)(A,{chapterId:r,addNewComment:e=>{c((t=>[...t,e]))}})]})},D=e=>{let{chapter:t,childChapters:r,onNavigate:n,onAddChapter:c,onGoBack:i,isLoading:g}=e;const{addNotification:j}=(0,y.z)(),v=(0,o.s0)(),[C]=(0,p.D)(x.ez),[w]=(0,p.D)(x.tT),[b,S]=(0,s.useState)(null),[k,N]=(0,s.useState)(!1),T=(e=>{const{data:t}=(0,a.a)(x.vR,{variables:{id:e}});return!!t&&t.isChapterLiked})(t.id);(0,s.useEffect)((()=>{S(T)}),[T]);const A=(()=>{const{addNotification:e}=(0,y.z)(),[t]=(0,p.D)(x.WQ),[r]=(0,p.D)(x.QN);return async(s,a)=>{if(s){const{data:r}=await t({variables:{id:a}});return e("Chapter liked",1e3,"success"),r.likeChapter}{const{data:t}=await r({variables:{id:a}});return e("Like removed",1e3,"error"),t.unlikeChapter}}})(),D=async()=>{console.log(t);try{if(0===t.branch){const e=await w({variables:{id:t.story.id}});e.data.deleteStory.success?(j(e.data.deleteStory.message,3e3,"success"),v("/"),console.log("Story deleted successfully")):(console.error(e.data.deleteStory.message),j(e.data.deleteStory.message,3e3,"error"))}else{const e=await C({variables:{id:t.id}});e.data.deleteChapter.success?(j(e.data.deleteChapter.message,3e3,"success"),v("/"),console.log("Chapter deleted successfully")):(console.error(e.data.deleteChapter.message),j(e.data.deleteChapter.message,3e3,"error"))}}catch(e){console.error("Error deleting:",e)}},{user:_}=(0,h.a)(),Y=!!_,B=l().sanitize(t.content);return(0,Z.jsxs)("div",{className:"chapter",children:[(0,Z.jsx)(d.Z,{variant:"secondary",className:"mb-3",onClick:()=>i(),children:(0,Z.jsx)(u.Z,{})}),(0,Z.jsx)("div",{className:"chapter-content shadow my-2",dangerouslySetInnerHTML:{__html:B}}),(0,Z.jsxs)("div",{className:"chapter-stats m-2",children:[Y?_.id===t.author.id?0===r.length?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(f.Z,{title:0===t.branch?"Delete story":"Delete chapter",description:0===t.branch?"Are you sure you want to delete this story":"Are you sure you want to delete this chapter",onConfirm:D,okText:"Yes",cancelText:"No",children:(0,Z.jsx)(d.Z,{variant:"danger",children:"Delete"})}),(0,Z.jsx)("span",{children:"Likes:"})]}):(0,Z.jsx)("span",{children:"Likes: "}):(0,Z.jsx)(d.Z,{disabled:k,variant:b?"success":"secondary",className:"mt-2",onClick:()=>(async()=>{if(N(!0),b){const e=await A(!1,t.id);S(!1),t.votes_count=t.votes_count-1,console.log("Unlike result:",e)}else{const e=await A(!0,t.id);t.votes_count=t.votes_count+1,S(!0),console.log("Like result:",e)}setTimeout((()=>{N(!1)}),1e3)})(),children:(0,Z.jsx)(m.Z,{})}):(0,Z.jsx)("span",{children:"Likes:"}),_?_.has_superpowers&&(0,Z.jsx)(f.Z,{title:0===t.branch?"Delete story":"Delete chapter",description:0===t.branch?"Are you sure you want to delete this story":"Are you sure you want to delete this chapter",onConfirm:D,okText:"Yes",cancelText:"No",children:(0,Z.jsx)(d.Z,{variant:"danger",children:"Admin delete"})}):(0,Z.jsx)(Z.Fragment,{}),(0,Z.jsx)("span",{children:t.votes_count})]}),(0,Z.jsxs)("div",{className:"next-chapters m-2",children:[!g&&Y&&r.length<3&&t.branch<9&&(0,Z.jsx)(d.Z,{variant:"secondary",className:"mr-3 mt-2",onClick:()=>c(),children:"Add Chapter"}),r.map((e=>(0,Z.jsxs)(d.Z,{variant:"secondary",className:"mr-3 mt-2",onClick:()=>n(e.id),children:["Continue to: ",e.title]},e.id)))]}),(0,Z.jsx)(I,{comments:t.comments,chapterId:t.id},t.id)]})};var _=r(43);const Y=["Your epic saga is so vast, even our scrolls are taking a while. Hang tight!","Your tale's intrigue has our library elves on their toes. One moment!","Such a legendary story requires some extra ink and quill. Bear with us...","Even the grand storytellers of old would be impressed! Prepping your narrative...","Your chapters are so gripping, our books needed a breather. Stay tuned...","Paging all scribes! Your monumental tale is on the way...","Even our magic mirrors need a second to capture the grandeur of your plot. Patience!","Your story has so many layers, even the onions are jealous. Peeling back the pages...","With tales as epic as yours, even the stars stop to listen. Setting the stage...","Weaving tales this intricate takes a touch of sorcery. Conjuring your story..."],B=()=>(0,Z.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:(0,Z.jsx)(j.Z,{style:{width:"300px",textAlign:"center"},children:(0,Z.jsxs)(j.Z.Body,{children:[(0,Z.jsx)(_.Z,{size:"large"}),(0,Z.jsx)(j.Z.Title,{children:"Fetching the Story..."}),(0,Z.jsx)(j.Z.Text,{children:Y[Math.floor(Math.random()*Y.length)]})]})})});var L=r(6916);const E=()=>{const e=(0,o.s0)(),{storyId:t,chapterId:r}=(0,o.UO)(),{data:i,loading:l,error:d}=(0,a.a)(x.$X,{variables:{id:t,chapterId:r}}),[h,{data:u,loading:m}]=(0,n.t)(x.SN),[p,{data:y}]=(0,n.t)(x.KV),f=(0,o.TH)(),{chapter:w,navigationStack:b}=f.state||{},[S,k]=(0,s.useState)(null),[N,T]=(0,s.useState)([]);if((0,s.useEffect)((()=>{w?(k(w),window.history.replaceState(null,"","/story/".concat(t,"/chapter/").concat(w.id)),b&&T(b)):i&&i.getStory&&i.getStory.chapters&&k(i.getStory.chapters[0])}),[w,i,b,t]),(0,s.useEffect)((()=>{S&&h({variables:{id:S.id}})}),[S,h]),(0,s.useEffect)((()=>{y&&y.getChapter&&(k(y.getChapter),window.history.replaceState(null,"","/story/".concat(t,"/chapter/").concat(y.getChapter.id)))}),[y,t]),l)return(0,Z.jsx)(B,{});if(d)return(0,Z.jsx)(L.Z,{message:d.message});return(0,Z.jsx)(g.Z,{className:"mt-5",children:(0,Z.jsxs)(v.Z,{children:[(0,Z.jsx)(C.Z,{md:9,children:S&&(0,Z.jsx)(D,{chapter:S,childChapters:u?u.getChapterChildren:[],onNavigate:e=>{let r;u&&u.getChapterChildren?r=u.getChapterChildren:i&&i.getStory&&Array.isArray(i.getStory.chapters)&&(r=i.getStory.chapters),window.scrollTo({top:0,behavior:"smooth"}),T([...N,S]);const s=r.find((t=>t.id===e));s?(k(s),window.history.replaceState(null,"","/story/".concat(t,"/chapter/").concat(s.id)),h({variables:{id:s.id}})):console.log("Chapter not found with the given ID:",e)},onAddChapter:()=>{e("/add-chapter",{state:{storyId:t,parentChapter:S,navigationStack:N}})},onGoBack:()=>{const r=N.pop();window.scrollTo({top:0,behavior:"smooth"}),console.log(S),T([...N]),r?(k(r),window.history.replaceState(null,"","/story/".concat(t,"/chapter/").concat(r.id))):S&&S.parentChapterId?p({variables:{getChapterId:S.parentChapterId}}):e("/")},isLoading:m})}),(0,Z.jsx)(C.Z,{md:3,children:S&&(0,Z.jsx)(j.Z,{children:(0,Z.jsxs)(j.Z.Body,{children:[(0,Z.jsx)(j.Z.Title,{children:i.getStory.title}),(0,Z.jsx)(j.Z.Subtitle,{className:"mb-2 text-muted",children:i.getStory.genre}),S.title&&(0,Z.jsxs)(j.Z.Text,{children:["Chapter ",S.branch+1,":",(0,Z.jsx)("br",{})," ",S.title]}),(0,Z.jsx)(j.Z.Text,{children:(0,Z.jsxs)("span",{children:["Reads: ",S&&S.reads_count]})}),(0,Z.jsx)(j.Z.Text,{children:(0,Z.jsxs)("small",{className:"text-muted",children:["Written by: ",S?(0,Z.jsx)(c.rU,{to:"/user/".concat(S.author.id),children:S.author.username}):(0,Z.jsx)(c.rU,{to:"/user/".concat(i.getStory.author.id),children:i.getStory.author.username})]})}),0===S.branch?(0,Z.jsx)(j.Z.Text,{children:i.getStory.description}):null,S.author.coffee&&(0,Z.jsxs)(j.Z.Text,{children:["Enjoying what ",S.author.username," is writing? ",(0,Z.jsx)("a",{href:S.author.coffee,target:"_blank",rel:"noreferrer",children:" Buy them a coffee "}),"  "]})]})})})]})})}}}]);
//# sourceMappingURL=546.410cb0c4.chunk.js.map