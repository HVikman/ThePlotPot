"use strict";(self.webpackChunktheplotpot_frontend=self.webpackChunktheplotpot_frontend||[]).push([[629],{4010:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var a=r(3216),n=r(3516),o=r(899),s=r(5211),c=r(6311),i=r(2823),l=r.n(i),h=(r(7590),r(1393),r(1881)),d=r(4743);var u=r(1898),p=(r(583),r(6133)),x=r(579);const g=o.Ik({title:o.Yj().required("Required").max(100,"Must be 100 characters or less"),content:o.Yj().required("Required")}),m={title:"",content:"",honeypot:""},y=()=>{const{isDarkMode:e}=(0,p.D2)(),t=(0,a.zy)(),{storyId:r,parentChapter:o,navigationStack:i}=t.state,{addNotification:y}=(0,u.E)(),[C,b]=((e,t,r,n)=>{const o=(0,a.Zp)(),[s,{error:c}]=(0,h.n)(d.xT,{update:(a,s)=>{let{data:{createChapter:i}}=s;try{const{getStory:s}=a.readQuery({query:d.Vm,variables:{id:e}}),c=[...s.chapters,i];a.writeQuery({query:d.Vm,variables:{id:e},data:{getStory:{...s,chapters:c}}});const{getChapterChildren:l}=a.readQuery({query:d.VE,variables:{id:t.id}}),h=[...l,i];a.writeQuery({query:d.VE,variables:{id:t.id},data:{getChapterChildren:h}}),n("".concat(i.title," created successfully!"),2e3,"success"),console.log(i),o("/story/".concat(e),{state:{chapter:i,navigationStack:[...r,t]}})}catch(c){console.error("Error updating cache after adding chapter:",c),n(c.message,2e3,"error")}}});return[s,c]})(r,o,i,y),v=(0,n.Wx)({initialValues:m,validationSchema:g,onSubmit:e=>{e.honeypot?console.log("Bot detected"):grecaptcha.ready((async()=>{const t=await grecaptcha.execute("6LfY0fooAAAAAKaljIbo723ZiMGApMCVg6ZU805o",{action:"submit"});C({variables:{storyId:r,parentChapterId:o.id,branch:o.branch+1,title:e.title,content:e.content,token:t}}).catch((e=>{console.error("There was an error creating the chapter:",e),y(e.message,3e3,"error")}))}))}});return(0,x.jsxs)("div",{className:"add-chapter-container mx-4",children:[(0,x.jsx)("h2",{children:"Add a New Chapter"}),(0,x.jsxs)(s.A,{onSubmit:v.handleSubmit,className:"".concat(e?"dark-mode":"light-mode"),children:[(0,x.jsxs)(s.A.Group,{controlId:"formTitle",children:[(0,x.jsx)(s.A.Label,{children:"Title"}),(0,x.jsx)(c.A,{type:"text",placeholder:"Chapter title",name:"title",onChange:v.handleChange,onBlur:v.handleBlur,value:v.values.title}),v.touched.title&&v.errors.title&&(0,x.jsx)(s.A.Text,{className:"text-danger",children:v.errors.title})]}),(0,x.jsx)(s.A.Group,{style:{display:"none"},controlId:"formHoneypot",children:(0,x.jsx)(c.A,{type:"text",name:"honeypot",onChange:v.handleChange,onBlur:v.handleBlur,value:v.values.honeypot})}),(0,x.jsxs)(s.A.Group,{controlId:"formContent",children:[(0,x.jsx)(s.A.Label,{children:"Content"}),(0,x.jsx)(l(),{value:v.values.content,placeholder:"Chapter content goes here...",onChange:e=>v.setFieldValue("content",e),theme:"snow",modules:{characterCounter:{container:"#char-count",maxChars:12e3},toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","blockquote"],[{list:"ordered"},{list:"bullet"}]]}}),(0,x.jsx)("div",{id:"char-count"}),v.touched.content&&v.errors.content&&(0,x.jsx)(s.A.Text,{className:"text-danger",children:v.errors.content})]})]}),b]})}},1393:(e,t,r)=>{var a=r(4175),n=r.n(a);class o{constructor(e,t){this.quill=e,this.options=t,this.container=document.querySelector(t.container),e.on("text-change",this.update.bind(this)),this.update()}calculate(){return this.quill.getText().length-1}update(){let e=this.calculate();if(e>this.options.maxChars){let e=this.quill.getText().substring(0,this.options.maxChars);this.quill.setText(e)}this.container.innerText=e+" / "+this.options.maxChars}}n().register("modules/characterCounter",o)},583:()=>{}}]);
//# sourceMappingURL=629.5933e92b.chunk.js.map